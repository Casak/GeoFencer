package casak.ru.geofencer.util;

import android.location.Location;
import android.location.LocationManager;
import android.os.AsyncTask;
import android.os.SystemClock;
import android.support.annotation.Nullable;

import com.google.android.gms.location.LocationListener;
import com.google.android.gms.maps.CameraUpdate;
import com.google.android.gms.maps.CameraUpdateFactory;
import com.google.android.gms.maps.model.LatLngBounds;
import com.google.android.gms.maps.model.Polygon;
import com.google.android.gms.maps.model.Polyline;
import com.google.maps.android.SphericalUtil;
import com.google.android.gms.maps.model.LatLng;
import com.google.android.gms.maps.model.PolygonOptions;
import com.google.android.gms.maps.model.PolylineOptions;

import java.util.ArrayList;
import java.util.LinkedList;
import java.util.List;

import casak.ru.geofencer.domain.Constants;

public class MapsUtils {

    static final double FIELD_HEIGHT_METERS = 100;
    static final double EARTH_RADIUS_METERS = 6371.008 * 1000;


    public static PolylineOptions createPolylineOptions(LatLng... latLngs) {
        return new PolylineOptions().add(latLngs);
    }

    public static PolylineOptions createArrow(LatLng routeCenter, double routeDistance, double routeHeading, boolean toLeft) {
        List<LatLng> result = new LinkedList<>();

        result.add(routeCenter);

        double headingArrowToTop;

        if (toLeft) {
            headingArrowToTop = routeHeading + Constants.HEADING_TO_LEFT;
        } else {
            headingArrowToTop = routeHeading + Constants.HEADING_TO_RIGHT;
        }

        double headingArrowToLeft = headingArrowToTop + 180 + 30;
        double headingArrowToRight = headingArrowToTop + 180 - 30;

        LatLng leftArrowTop = SphericalUtil.computeOffset(routeCenter, routeDistance / 2, headingArrowToTop);
        LatLng leftArrowFromTopToLeft = SphericalUtil.computeOffset(leftArrowTop, routeDistance / 4, headingArrowToLeft);
        LatLng leftArrowFromTopToRight = SphericalUtil.computeOffset(leftArrowTop, routeDistance / 4, headingArrowToRight);

        result.add(leftArrowTop);
        result.add(leftArrowFromTopToLeft);
        result.add(leftArrowTop);
        result.add(leftArrowFromTopToRight);
        result.add(leftArrowTop);

        return new PolylineOptions()
                .addAll(result)
                .width(20f)
                .color(Constants.ARROW_COLOR)
                .geodesic(true)
                .clickable(true);
    }

    public static PolylineOptions createPolylineOptions(List<LatLng> latLngs) {
        return new PolylineOptions()
                .add(latLngs.toArray(new LatLng[latLngs.size()]))
                .geodesic(true);
    }

    //TODO rename signature
    public static PolygonOptions createFieldPolygonOptions(LatLng start, LatLng end, double width, boolean toLeft) {
        double offset = width == 0 ? 0d : width / 2;
        return new PolygonOptions()
                .add(computeCorners(start, end, offset, toLeft).toArray(new LatLng[4]))
                .fillColor(Constants.FIELD_FILL_COLOR)
                .strokeColor(Constants.FIELD_STROKE_COLOR)
                .geodesic(true);
    }

    public static List<LatLng> computeCorners(LatLng start, LatLng end, double offset, boolean toLeft) {
        double heading = SphericalUtil.computeHeading(start, end);

        List<LatLng> result = new ArrayList<>(4);

        double heading1, heading2;
        if (toLeft) {
            heading1 = 90;
            heading2 = -90;
        } else {
            heading1 = -90;
            heading2 = 90;
        }

        LatLng cornerSouthWest = SphericalUtil.computeOffset(start, offset, heading + heading1);
        LatLng cornerNorthWest = SphericalUtil.computeOffset(cornerSouthWest, FIELD_HEIGHT_METERS, heading + heading2);
        LatLng cornerSouthEast = SphericalUtil.computeOffset(end, offset, heading + heading1);
        LatLng cornerNorthEast = SphericalUtil.computeOffset(cornerSouthEast, FIELD_HEIGHT_METERS, heading + heading2);

        result.add(cornerNorthWest);
        result.add(cornerSouthWest);
        result.add(cornerSouthEast);
        result.add(cornerNorthEast);
        return result;
    }


    //TODO rename
    public static List<LatLng> computeNewPath(Polyline polyline, double width, double heading) {
        List<LatLng> points = polyline.getPoints();
        List<LatLng> result = new ArrayList<>(points.size());

        for (LatLng point : points) {
            LatLng newPoint = SphericalUtil.computeOffset(point, width, heading);
            result.add(newPoint);
        }
        return result;
    }

    //TODO implement
    public static CameraUpdate harvestedPolygonToCameraUpdate(Polygon polygon) {
        List<LatLng> points = polygon.getPoints();
        if (points == null || points.size() < 1)
            return null;

        LatLngBounds.Builder boundsBuilder = new LatLngBounds.Builder();
        boundsBuilder.include(points.get(0));
        boundsBuilder.include(points.get(points.size() / 2 - 1));
        LatLngBounds bounds = boundsBuilder.build();

        return CameraUpdateFactory.newLatLngBounds(bounds, 1);
    }

    public static CameraUpdate fieldPolygonToCameraUpdate(Polygon polygon) {
        List<LatLng> points = polygon.getPoints();
        if (points == null || points.size() < 4)
            return null;

        LatLngBounds.Builder boundsBuilder = new LatLngBounds.Builder();
        boundsBuilder.include(points.get(Constants.NORTH_EAST));
        boundsBuilder.include(points.get(Constants.SOUTH_WEST));
        LatLngBounds bounds = boundsBuilder.build();

        return CameraUpdateFactory.newLatLngBounds(bounds, 100);
    }

    public static CameraUpdate latLngToCameraUpdate(LatLng latLng) {
        return CameraUpdateFactory.newLatLng(latLng);
    }

    public static PolygonOptions harvestedPolygonOptions(Polyline route) {
        List<LatLng> points = route.getPoints();
        List<LatLng> upperBound = new LinkedList<>();
        List<LatLng> bottomBound = new LinkedList<>();
        List<LatLng> fullArea = new LinkedList<>();

        if (points.size() > 1) {
            LatLng start = points.get(0);
            LatLng end = points.get(points.size() - 1);
            double heading = SphericalUtil.computeHeading(start, end);

            for (LatLng point : points) {
                upperBound.add(SphericalUtil.computeOffset(point,
                        Constants.WIDTH_METERS / 2,
                        heading + 90));
                bottomBound.add(SphericalUtil.computeOffset(point,
                        Constants.WIDTH_METERS / 2,
                        heading - 90));
            }
            fullArea.addAll(upperBound);
            for (int i = bottomBound.size() - 1; i >= 0; i--)
                fullArea.add(bottomBound.get(i));
            return new PolygonOptions()
                    .add(fullArea.toArray(new LatLng[fullArea.size()]))
                    .fillColor(Constants.HARVESTED_FILL_COLOR)
                    .strokeColor(Constants.HARVESTED_STROKE_COLOR)
                    .zIndex(Constants.HARVESTED_INDEX)
                    .geodesic(true);
        }
        return null;
    }

    public LatLng computeCentralPoint(LatLng start, LatLng end) {
        double distanceToCenter = SphericalUtil.computeDistanceBetween(start, end) / 2;
        double heading = SphericalUtil.computeHeading(start, end);
        return SphericalUtil.computeOffset(start, distanceToCenter, heading);
    }


    public static void mockLocations(LocationListener listener, @Nullable LatLng... locations) {
        new MockLocationAsyncTask(listener).execute(locations);
    }

    private static class MockLocationAsyncTask extends AsyncTask<LatLng, Location, String> {
        List<Location> locations = new LinkedList<>();
        LocationListener listener;

        public MockLocationAsyncTask(LocationListener locationListener) {
            listener = locationListener;
        }

        private void initLocations() {
            String locationsString =
                    "50.4152166,30.4242162;" +
                            "50.4152448,30.4242259;" +
                            "50.4152724,30.4242367;" +
                            "50.4152966,30.4242467;" +
                            "50.4153186,30.4242533;" +
                            "50.4153398,30.4242531;" +
                            "50.4153646,30.4242399;" +
                            "50.4153874,30.4242096;" +
                            "50.4154044,30.4241695;" +
                            "50.4154170,30.4241284;" +
                            "50.4154278,30.4240883;" +
                            "50.415437,30.4240488;" +
                            "50.4154453,30.4240104;" +
                            "50.4154618,30.4239535;" +
                            "50.4154662,30.4239438;" +
                            "50.4154664,30.4239433;" +
                            "50.4154664,30.4239433;" +
                            "50.4154687,30.4239383;" +
                            "50.4154801,30.4239;" +
                            "50.4155033,30.4239033;" +
                            "50.415531,30.4239060;" +
                            "50.4155631,30.4239146;" +
                            "50.41559,30.4239242;" +
                            "50.4156336,30.4239335;" +
                            "50.4157078,30.4239513;" +
                            "50.4157520,30.4239631;" +
                            "50.415800,30.4239762;" +
                            "50.4158516,30.423990;" +
                            "50.4159050,30.4240061;" +
                            "50.4159602,30.4240214;" +
                            "50.4160168,30.4240369;" +
                            "50.4160749,30.4240527;" +
                            "50.4161335,30.4240690;" +
                            "50.416192,30.4240851;" +
                            "50.4162523,30.4241006;" +
                            "50.4163123,30.4241164;" +
                            "50.4163719,30.4241319;" +
                            "50.4164901,30.4241637;" +
                            "50.416548,30.4241804;" +
                            "50.4166062,30.4241966;" +
                            "50.4166633,30.4242119;" +
                            "50.4167237,30.4242270;" +
                            "50.4167880,30.4242391;" +
                            "50.4168540,30.4242513;" +
                            "50.4169194,30.4242660;" +
                            "50.4169865,30.424282;" +
                            "50.4170545,30.4242985;" +
                            "50.4171213,30.4243170;" +
                            "50.4171855,30.4243405;" +
                            "50.417309,30.4243930;" +
                            "50.4174310,30.4244325;" +
                            "50.4174921,30.4244499;" +
                            "50.4175530,30.4244674;" +
                            "50.4176138,30.4244825;" +
                            "50.4176746,30.4244990;" +
                            "50.4177354,30.4245152;" +
                            "50.4177963,30.4245335;" +
                            "50.4178588,30.424550;" +
                            "50.417922,30.42456;" +
                            "50.4179847,30.4245844;" +
                            "50.4180465,30.4246029;" +
                            "50.4181098,30.4246226;" +
                            "50.4182384,30.4246615;" +
                            "50.4183014,30.4246766;" +
                            "50.4183620,30.4246946;" +
                            "50.4184226,30.4247127;" +
                            "50.4184828,30.4247306;" +
                            "50.41854,30.4247476;" +
                            "50.4186000,30.424766;" +
                            "50.4186571,30.42478;" +
                            "50.4187137,30.4248011;" +
                            "50.4187696,30.4248166;" +
                            "50.4188250,30.4248322;" +
                            "50.418879,30.424846;" +
                            "50.4189330,30.4248617;" +
                            "50.4190339,30.4248907;" +
                            "50.419081,30.4249039;" +
                            "50.4191274,30.4249164;" +
                            "50.419171,30.4249279;" +
                            "50.4192133,30.424938;" +
                            "50.4192562,30.4249485;" +
                            "50.4193085,30.4249590;" +
                            "50.4193675,30.4249718;" +
                            "50.4194315,30.4249884;" +
                            "50.4195003,30.4250072;" +
                            "50.4195733,30.4250277;" +
                            "50.4196441,30.4250484;" +
                            "50.4197886,30.4250912;" +
                            "50.4198625,30.4251132;" +
                            "50.4199367,30.425135;" +
                            "50.4200126,30.4251571;" +
                            "50.4200889,30.4251791;" +
                            "50.4201653,30.4252027;" +
                            "50.4202420,30.4252242;" +
                            "50.4203219,30.4252461;" +
                            "50.4204062,30.4252681;" +
                            "50.4204965,30.4252927;" +
                            "50.4205917,30.4253183;" +
                            "50.4206892,30.4253482;" +
                            "50.4207868,30.4253798;" +
                            "50.4209817,30.4254454;" +
                            "50.4210783,30.4254868;" +
                            "50.4211722,30.425535;" +
                            "50.4212645,30.4255889;" +
                            "50.421355,30.4256428;" +
                            "50.4214449,30.4256972;" +
                            "50.4215316,30.4257533;" +
                            "50.4216150,30.425807;" +
                            "50.4216995,30.4258595;" +
                            "50.4217846,30.4259127;" +
                            "50.4218679,30.4259648;" +
                            "50.421949,30.4260166;" +
                            "50.4220291,30.4260660;" +
                            "50.422107,30.4261144;" +
                            "50.4223769,30.4262649;" +
                            "50.4224690,30.4263184;" +
                            "50.4225544,30.4263715;" +
                            "50.4226348,30.4264244;" +
                            "50.4227066,30.4264715;" +
                            "50.4227738,30.4265161;" +
                            "50.4228396,30.4265580;" +
                            "50.4229029,30.4265987;" +
                            "50.4229644,30.4266370;" +
                            "50.4230170,30.4266696;" +
                            "50.4230622,30.4266969;" +
                            "50.4231028,30.4267206;" +
                            "50.4231742,30.4267600;" +
                            "50.4232012,30.426774;" +
                            "50.4232177,30.4267845;" +
                            "50.4232268,30.4267898;" +
                            "50.423230,30.4267916;" +
                            "50.4232308,30.4267916;" +
                            "50.4232309,30.4267921;" +
                            "50.4232307,30.426792;" +
                            "50.4232309,30.4267927;" +
                            "50.4232309,30.426793;" +
                            "50.4232306,30.4267957;" +
                            "50.4232315,30.42679;" +
                            "50.4232315,30.4267962;" +
                            "50.4232316,30.4267972;" +
                            "50.4232317,30.4267978;" +
                            "50.4232317,30.4267978;" +
                            "50.4232317,30.4267978;" +
                            "50.4232315,30.4267987;" +
                            "50.4232315,30.4267987;" +
                            "50.423231,30.4267991;" +
                            "50.423231,30.4267991;" +
                            "50.423231,30.4267992;" +
                            "50.423231,30.4267993;" +
                            "50.423231,30.4267993;" +
                            "50.423231,30.4267993;" +
                            "50.4232317,30.4267993;" +
                            "50.423231,30.4267992;" +
                            "50.4232318,30.4267992;" +
                            "50.4232320,30.4267994;" +
                            "50.4232352,30.426801;" +
                            "50.4232381,30.4268025;" +
                            "50.4232449,30.4268061;" +
                            "50.4232583,30.4268134;" +
                            "50.4232668,30.426818;" +
                            "50.4232742,30.4268215;" +
                            "50.423277,30.426824;" +
                            "50.423288,30.426830;" +
                            "50.4233018,30.4268378;" +
                            "50.4233117,30.426841;" +
                            "50.4233174,30.4268439;" +
                            "50.4233195,30.4268448;" +
                            "50.4233196,30.4268447;" +
                            "50.4233197,30.4268446;" +
                            "50.4233200,30.4268444;" +
                            "50.423324,30.4268471;" +
                            "50.4233275,30.4268487;" +
                            "50.4233277,30.4268490;" +
                            "50.4233249,30.4268515;" +
                            "50.4233249,30.4268515;" +
                            "50.423321,30.4268548;" +
                            "50.4233207,30.4268572;" +
                            "50.4233207,30.4268572;" +
                            "50.4233207,30.4268568;" +
                            "50.4233207,30.4268568;" +
                            "50.4233207,30.4268568;" +
                            "50.423320,30.4268576;" +
                            "50.423320,30.4268576;" +
                            "50.4233205,30.4268575;" +
                            "50.4233216,30.4268581;" +
                            "50.4233316,30.4268629;" +
                            "50.4233466,30.4268692;" +
                            "50.4233671,30.4268758;" +
                            "50.4233951,30.4268875;" +
                            "50.4234245,30.4268994;" +
                            "50.4234522,30.4269112;" +
                            "50.4234773,30.4269235;" +
                            "50.423500,30.4269348;" +
                            "50.423521,30.4269468;" +
                            "50.4235397,30.426958;" +
                            "50.4235533,30.426967;" +
                            "50.4235590,30.4269715;" +
                            "50.4235591,30.4269716;" +
                            "50.4235591,30.4269716;" +
                            "50.4235592,30.4269711;" +
                            "50.4235592,30.4269711;" +
                            "50.4235593,30.4269695;" +
                            "50.4235595,30.4269696;" +
                            "50.4235595,30.4269696;" +
                            "50.4235599,30.4269679;" +
                            "50.4235599,30.4269679;" +
                            "50.423560,30.4269660;" +
                            "50.4235606,30.4269660;" +
                            "50.4235606,30.4269660;" +
                            "50.423561,30.4269642;" +
                            "50.423561,30.4269642;" +
                            "50.4235608,30.4269634;" +
                            "50.4235610,30.4269633;" +
                            "50.4235610,30.4269633;" +
                            "50.423560,30.4269625;" +
                            "50.423560,30.4269625;" +
                            "50.4235603,30.4269618;" +
                            "50.4235595,30.4269623;" +
                            "50.4235595,30.4269623;" +
                            "50.4235592,30.4269617;" +
                            "50.4235592,30.4269617;" +
                            "50.4235589,30.4269613;" +
                            "50.4235585,30.4269613;" +
                            "50.4235585,30.4269613;" +
                            "50.4235583,30.4269610;" +
                            "50.4235582,30.4269608;" +
                            "50.4235581,30.4269608;" +
                            "50.4235581,30.4269608;" +
                            "50.4235580,30.4269607;" +
                            "50.4235580,30.4269607;" +
                            "50.4235580,30.4269606;" +
                            "50.4235583,30.4269608;" +
                            "50.4235583,30.4269608;" +
                            "50.4235583,30.4269607;" +
                            "50.423558,30.4269610;" +
                            "50.4235687,30.4269677;" +
                            "50.4235824,30.4269769;" +
                            "50.4235952,30.4269856;" +
                            "50.4236076,30.4269939;" +
                            "50.4236180,30.4270008;" +
                            "50.4236,30.4270066;" +
                            "50.4236336,30.4270111;" +
                            "50.423639,30.4270149;" +
                            "50.4236433,30.4270175;" +
                            "50.4236460,30.4270193;" +
                            "50.4236473,30.4270202;" +
                            "50.4236526,30.4270234;" +
                            "50.423663,30.4270299;" +
                            "50.424106,30.4258221;" +
                            "50.4244806,30.4244541;" +
                            "50.4245153,30.4243218;" +
                            "50.424533,30.4242552;" +
                            "50.4245500,30.4241900;" +
                            "50.4245672,30.4241263;" +
                            "50.4245842,30.4240613;" +
                            "50.4246010,30.4239987;" +
                            "50.4246182,30.4239360;" +
                            "50.4246520,30.4238136;" +
                            "50.4246676,30.423756;" +
                            "50.4246817,30.4237022;" +
                            "50.424694,30.4236567;" +
                            "50.4247057,30.4236142;" +
                            "50.4247170,30.4235741;" +
                            "50.4247275,30.4235332;" +
                            "50.4247378,30.4234936;" +
                            "50.4247678,30.4233762;" +
                            "50.4247835,30.4233153;" +
                            "50.4248020,30.4232326;" +
                            "50.4248222,30.4231244;" +
                            "50.4248495,30.4229929;" +
                            "50.4248862,30.4228459;" +
                            "50.4249288,30.4226931;" +
                            "50.4250224,30.4223778;" +
                            "50.425069,30.4222239;" +
                            "50.4251161,30.4220731;" +
                            "50.4251594,30.4219407;" +
                            "50.4251912,30.42184;" +
                            "50.4252081,30.421800;" +
                            "50.4252277,30.4217455;" +
                            "50.4252424,30.4217041;" +
                            "50.425263,30.4216457;" +
                            "50.4252902,30.4215688;" +
                            "50.4253256,30.421469;" +
                            "50.4253662,30.4213576;" +
                            "50.4254073,30.4212431;" +
                            "50.4254553,30.4211167;" +
                            "50.4255726,30.4208220;" +
                            "50.4256422,30.420655;" +
                            "50.4257183,30.4204765;" +
                            "50.4258019,30.4202868;" +
                            "50.4258918,30.4200905;" +
                            "50.4259847,30.4198935;" +
                            "50.4260761,30.419698;" +
                            "50.4261639,30.4195100;" +
                            "50.4263472,30.4191530;" +
                            "50.4264417,30.4189852;" +
                            "50.4265367,30.418822;" +
                            "50.4266265,30.4186659;" +
                            "50.4267180,30.4185090;" +
                            "50.4269054,30.4182195;" +
                            "50.4269967,30.4180754;" +
                            "50.427087,30.4179359;" +
                            "50.427178,30.4178013;" +
                            "50.427265,30.4176712;" +
                            "50.4273535,30.4175441;" +
                            "50.4275306,30.4173067;" +
                            "50.4276187,30.4171936;" +
                            "50.4277042,30.4170841;" +
                            "50.4277892,30.4169768;" +
                            "50.4278726,30.4168717;" +
                            "50.4279555,30.4167709;" +
                            "50.4280368,30.4166748;" +
                            "50.4281191,30.4165812;" +
                            "50.4282781,30.4164027;" +
                            "50.4283643,30.4163203;" +
                            "50.4284604,30.4162223;" +
                            "50.4285458,30.4161327;" +
                            "50.4286147,30.4160678;" +
                            "50.428662,30.4160307;" +
                            "50.428724,30.4159790;" +
                            "50.4286945,30.4158710;" +
                            "50.4286791,30.4158187;" +
                            "50.4286428,30.4157820;" +
                            "50.4285874,30.4157847;" +
                            "50.4285297,30.4158381;" +
                            "50.4284745,30.4159020;" +
                            "50.4284126,30.4159696;" +
                            "50.4283457,30.416037;" +
                            "50.4282065,30.416173;" +
                            "50.4281363,30.4162433;" +
                            "50.4280541,30.4163374;" +
                            "50.4279729,30.4164285;" +
                            "50.4278920,30.4165195;" +
                            "50.4278120,30.4166111;" +
                            "50.4277319,30.4167061;" +
                            "50.4276524,30.4168006;" +
                            "50.4275107,30.4169772;" +
                            "50.4274436,30.417059;" +
                            "50.4273821,30.4171383;" +
                            "50.4273297,30.4172153;" +
                            "50.4272812,30.4172894;" +
                            "50.4272304,30.4173654;" +
                            "50.427171,30.4174486;" +
                            "50.4271029,30.4175485;" +
                            "50.4269511,30.4177708;" +
                            "50.426878,30.4178877;" +
                            "50.4268083,30.418000;" +
                            "50.4267406,30.4181099;" +
                            "50.4266665,30.4182285;" +
                            "50.4265843,30.4183588;" +
                            "50.4264959,30.4185048;" +
                            "50.4263117,30.4188287;" +
                            "50.4262165,30.4190054;" +
                            "50.4261188,30.4191961;" +
                            "50.4260149,30.4193961;" +
                            "50.4259068,30.4196070;" +
                            "50.4257980,30.4198317;" +
                            "50.4255818,30.4203131;" +
                            "50.4254794,30.4205548;" +
                            "50.425387,30.4207816;" +
                            "50.4253036,30.4209949;" +
                            "50.4252274,30.4212047;" +
                            "50.4251605,30.4214055;" +
                            "50.4250958,30.4215988;" +
                            "50.4250297,30.4217876;" +
                            "50.4249032,30.4221620;" +
                            "50.424845,30.4223486;" +
                            "50.4247927,30.4225321;" +
                            "50.4247503,30.4226862;" +
                            "50.4247199,30.4227979;" +
                            "50.4247000,30.4228708;" +
                            "50.4246834,30.422930;" +
                            "50.4246682,30.4229863;" +
                            "50.4246408,30.4230880;" +
                            "50.4246283,30.4231369;" +
                            "50.4246121,30.4231997;" +
                            "50.4245913,30.423281;" +
                            "50.4245656,30.4233846;" +
                            "50.4245336,30.4235082;" +
                            "50.4244944,30.4236452;" +
                            "50.4244494,30.4237819;" +
                            "50.4243635,30.4240501;" +
                            "50.4243245,30.4241793;" +
                            "50.4242930,30.4242920;" +
                            "50.42426,30.4243811;" +
                            "50.4242538,30.4244392;" +
                            "50.4242448,30.4244736;" +
                            "50.42423,30.4244932;" +
                            "50.4242372,30.4245029;" +
                            "50.424236,30.4245053;" +
                            "50.4242365,30.4245053;" +
                            "50.4242365,30.4245053;" +
                            "50.4242365,30.4245053;" +
                            "50.4242365,30.4245053;" +
                            "50.4242365,30.4245053;" +
                            "50.4242365,30.4245053;" +
                            "50.4242365,30.4245053;" +
                            "50.4242349,30.4245115;" +
                            "50.4242298,30.4245318;" +
                            "50.4242243,30.424552;" +
                            "50.4242189,30.4245733;" +
                            "50.4242139,30.424592;" +
                            "50.424209,30.4246080;" +
                            "50.4242065,30.4246193;" +
                            "50.4242042,30.4246279;" +
                            "50.4241995,30.4246447;" +
                            "50.4241916,30.4246738;" +
                            "50.424184,30.4247015;" +
                            "50.4241779,30.424724;" +
                            "50.4241728,30.4247440;" +
                            "50.4241681,30.4247607;" +
                            "50.4241624,30.4247820;" +
                            "50.424154,30.4248108;" +
                            "50.4241534,30.4248142;" +
                            "50.4241534,30.4248142;" +
                            "50.4241534,30.4248142;" +
                            "50.4241534,30.4248140;" +
                            "50.4241521,30.4248190;" +
                            "50.4241465,30.4248391;" +
                            "50.4241342,30.4248843;" +
                            "50.4241286,30.4249055;" +
                            "50.424123,30.4249228;" +
                            "50.4241200,30.4249373;" +
                            "50.4241137,30.4249616;" +
                            "50.4241001,30.4250125;" +
                            "50.4240947,30.4250326;" +
                            "50.4240903,30.4250494;" +
                            "50.4240869,30.4250628;" +
                            "50.4240844,30.4250730;" +
                            "50.4240826,30.4250801;" +
                            "50.4240818,30.425082;" +
                            "50.4240818,30.425082;" +
                            "50.4240818,30.425082;" +
                            "50.4240818,30.425082;" +
                            "50.4240818,30.425082;" +
                            "50.4240818,30.425082;" +
                            "50.4240818,30.425082;" +
                            "50.4240818,30.425082;" +
                            "50.4240818,30.425082;" +
                            "50.4240818,30.4250826;" +
                            "50.4240818,30.4250826;" +
                            "50.4240818,30.4250826;" +
                            "50.4240818,30.425082;" +
                            "50.4240818,30.425082;" +
                            "50.4240818,30.425082;" +
                            "50.4240818,30.425082;" +
                            "50.4240818,30.425082;" +
                            "50.4240818,30.425082;" +
                            "50.4240818,30.425082;" +
                            "50.4240818,30.425082;" +
                            "50.4240818,30.425082;" +
                            "50.4240818,30.4250826;" +
                            "50.4240818,30.4250826;" +
                            "50.4240818,30.4250826;" +
                            "50.4240818,30.4250826;" +
                            "50.4240818,30.4250826;" +
                            "50.4240818,30.4250826;" +
                            "50.4240818,30.4250826;" +
                            "50.4240818,30.4250826;" +
                            "50.4240818,30.4250826;" +
                            "50.4240818,30.4250826;" +
                            "50.4240818,30.4250826;" +
                            "50.4240818,30.4250826;" +
                            "50.4240818,30.4250826;" +
                            "50.4240818,30.4250826;" +
                            "50.4240818,30.4250826;" +
                            "50.4240818,30.4250826;" +
                            "50.4240818,30.4250826;" +
                            "50.4240818,30.4250827;" +
                            "50.4240818,30.4250827;" +
                            "50.4240818,30.4250827;" +
                            "50.4240818,30.4250827;" +
                            "50.4240818,30.4250827;" +
                            "50.4240818,30.425082;" +
                            "50.4240818,30.425082;" +
                            "50.4240818,30.425082;" +
                            "50.4240818,30.425082;" +
                            "50.4240819,30.4250827;" +
                            "50.4240819,30.4250827;" +
                            "50.4240819,30.4250827;" +
                            "50.4240793,30.425092;" +
                            "50.4240728,30.4251179;" +
                            "50.4240641,30.4251527;" +
                            "50.4240561,30.425183;" +
                            "50.4240492,30.4252104;" +
                            "50.4240422,30.425237;" +
                            "50.4240333,30.4252715;" +
                            "50.4240142,30.4253489;" +
                            "50.4240026,30.4253955;" +
                            "50.4239911,30.4254395;" +
                            "50.4239806,30.4254790;" +
                            "50.423971,30.4255142;" +
                            "50.4239567,30.4255704;" +
                            "50.4239511,30.4255940;" +
                            "50.4239458,30.4256152;" +
                            "50.4239398,30.4256388;" +
                            "50.4239343,30.4256609;" +
                            "50.4239305,30.4256762;" +
                            "50.4239293,30.4256810;" +
                            "50.4239293,30.4256809;" +
                            "50.4239293,30.4256809;" +
                            "50.4239293,30.4256809;" +
                            "50.4239293,30.4256809;" +
                            "50.4239293,30.4256809;" +
                            "50.4239293,30.4256809;" +
                            "50.4239293,30.4256809;" +
                            "50.4239293,30.4256809;" +
                            "50.4239293,30.4256809;" +
                            "50.4239293,30.4256809;" +
                            "50.4239293,30.4256809;" +
                            "50.4239293,30.4256809;" +
                            "50.423929,30.4256809;" +
                            "50.423929,30.4256809;" +
                            "50.423929,30.4256809;" +
                            "50.423929,30.4256809;" +
                            "50.423929,30.4256809;" +
                            "50.4239293,30.4256809;" +
                            "50.4239293,30.4256809;" +
                            "50.4239293,30.4256809;" +
                            "50.4239293,30.4256809;" +
                            "50.4239293,30.4256809;" +
                            "50.4239293,30.4256809;" +
                            "50.4239293,30.4256809;" +
                            "50.4239293,30.4256809;" +
                            "50.4239293,30.4256809;" +
                            "50.4239293,30.4256809;" +
                            "50.4239293,30.4256809;" +
                            "50.4239293,30.4256809;" +
                            "50.4239293,30.4256809;" +
                            "50.4239293,30.4256809;" +
                            "50.4239293,30.4256809;" +
                            "50.4239293,30.4256808;" +
                            "50.4239293,30.4256809;" +
                            "50.4239294,30.4256809;" +
                            "50.4239294,30.4256809;" +
                            "50.4239294,30.4256809;" +
                            "50.4239294,30.4256809;" +
                            "50.4239294,30.4256809;" +
                            "50.4239294,30.4256809;" +
                            "50.4239294,30.4256809;" +
                            "50.4239186,30.4257226;" +
                            "50.4239075,30.4257640;" +
                            "50.4238961,30.425805;" +
                            "50.4238863,30.4258397;" +
                            "50.423877,30.4258717;" +
                            "50.4238670,30.4259077;" +
                            "50.4238551,30.4259496;" +
                            "50.4238385,30.4260109;" +
                            "50.4238343,30.4260259;" +
                            "50.4238309,30.426038;" +
                            "50.4238247,30.426062;" +
                            "50.4238156,30.4260987;" +
                            "50.423803,30.4261441;" +
                            "50.4237902,30.4261959;" +
                            "50.4237766,30.4262463;" +
                            "50.4237532,30.4263352;" +
                            "50.4237431,30.4263726;" +
                            "50.423733,30.4264070;" +
                            "50.423725,30.426439;" +
                            "50.4237172,30.4264688;" +
                            "50.4237100,30.4264961;" +
                            "50.4236979,30.4265431;" +
                            "50.4236929,30.4265629;" +
                            "50.4236888,30.4265795;" +
                            "50.4236854,30.4265933;" +
                            "50.4236835,30.4266010;" +
                            "50.4236832,30.4266017;" +
                            "50.4236832,30.4266017;" +
                            "50.4236832,30.4266017;" +
                            "50.4236832,30.4266017;" +
                            "50.4236832,30.4266017;" +
                            "50.4236832,30.4266017;" +
                            "50.4236832,30.4266017;" +
                            "50.4236832,30.4266017;" +
                            "50.4236832,30.4266017;" +
                            "50.4236832,30.426601;" +
                            "50.4236832,30.426601;" +
                            "50.4236832,30.426601;" +
                            "50.4236832,30.426601;" +
                            "50.4236832,30.426601;" +
                            "50.4236832,30.426601;" +
                            "50.4236832,30.426601;" +
                            "50.4236832,30.426601;" +
                            "50.4236832,30.426601;" +
                            "50.4236832,30.426601;" +
                            "50.4236832,30.426601;" +
                            "50.4236832,30.426601;" +
                            "50.4236832,30.426601;" +
                            "50.4236832,30.426601;" +
                            "50.4236832,30.426601;" +
                            "50.4236832,30.426601;" +
                            "50.4236832,30.426601;" +
                            "50.4236832,30.426601;" +
                            "50.4236832,30.426601;" +
                            "50.4236832,30.426601;" +
                            "50.4236832,30.426601;" +
                            "50.4236832,30.426601;" +
                            "50.4236832,30.426601;" +
                            "50.4236832,30.426601;" +
                            "50.4236832,30.426601;" +
                            "50.4236832,30.4266017;" +
                            "50.4236832,30.4266017;" +
                            "50.4236832,30.4266017;" +
                            "50.4236832,30.4266017;" +
                            "50.4236832,30.4266017;" +
                            "50.4236832,30.4266018;" +
                            "50.4236812,30.4266095;" +
                            "50.4236714,30.4266477;" +
                            "50.423664,30.4266721;" +
                            "50.423658,30.4266922;" +
                            "50.4236536,30.426707;" +
                            "50.4236501,30.4267179;" +
                            "50.4236489,30.4267211;" +
                            "50.4236489,30.4267215;" +
                            "50.4236451,30.426731;" +
                            "50.4236361,30.4267542;" +
                            "50.4236295,30.4267699;" +
                            "50.4236201,30.426788;" +
                            "50.4236088,30.4268060;" +
                            "50.4235981,30.4268174;" +
                            "50.4235809,30.4268302;" +
                            "50.4235575,30.4268366;" +
                            "50.4235350,30.4268355;" +
                            "50.423485,30.4268134;" +
                            "50.4234573,30.4267958;" +
                            "50.4234261,30.4267767;" +
                            "50.4233919,30.4267571;" +
                            "50.4233542,30.4267341;" +
                            "50.4232695,30.426683;" +
                            "50.4232131,30.4266485;" +
                            "50.4231497,30.4266082;" +
                            "50.4230814,30.4265633;" +
                            "50.4230097,30.4265150;" +
                            "50.4229376,30.4264669;" +
                            "50.4228656,30.4264196;" +
                            "50.4227862,30.4263676;" +
                            "50.4226108,30.4262531;" +
                            "50.4225178,30.4261930;" +
                            "50.4224289,30.4261358;" +
                            "50.4223570,30.426089;" +
                            "50.4223039,30.4260545;" +
                            "50.4222625,30.4260265;" +
                            "50.422226,30.4260017;" +
                            "50.4221955,30.4259804;" +
                            "50.422131,30.4259353;" +
                            "50.4220810,30.4259028;" +
                            "50.4220163,30.4258603;" +
                            "50.4219417,30.4258112;" +
                            "50.4218677,30.4257624;" +
                            "50.4217922,30.4257129;" +
                            "50.4217105,30.4256604;" +
                            "50.4216249,30.4256047;" +
                            "50.4213502,30.4254341;" +
                            "50.4212543,30.4253797;" +
                            "50.4211577,30.4253296;" +
                            "50.4210611,30.4252845;" +
                            "50.4209645,30.4252452;" +
                            "50.4208677,30.4252115;" +
                            "50.4207723,30.4251825;" +
                            "50.4206043,30.4251335;" +
                            "50.4205249,30.4251113;" +
                            "50.4204482,30.4250907;" +
                            "50.420375,30.4250710;" +
                            "50.4203125,30.4250543;" +
                            "50.4202624,30.425040;" +
                            "50.4202252,30.4250294;" +
                            "50.4201834,30.4250174;" +
                            "50.4201577,30.4250100;" +
                            "50.420154,30.4250091;" +
                            "50.4201542,30.4250091;" +
                            "50.4201542,30.4250091;" +
                            "50.4201537,30.4250090;" +
                            "50.4201474,30.4250072;" +
                            "50.4201383,30.4250047;" +
                            "50.4201,30.4249942;" +
                            "50.4200766,30.42498;" +
                            "50.420049,30.4249806;" +
                            "50.4200213,30.4249728;" +
                            "50.4199871,30.4249629;" +
                            "50.4199519,30.4249518;" +
                            "50.419915,30.4249421;" +
                            "50.419875,30.424932;" +
                            "50.4197813,30.4249135;" +
                            "50.4197293,30.4249030;" +
                            "50.4196669,30.4248866;" +
                            "50.4196004,30.4248662;" +
                            "50.4195329,30.424846;" +
                            "50.4194658,30.424825;" +
                            "50.4193983,30.4248052;" +
                            "50.4193300,30.4247856;" +
                            "50.4191909,30.4247469;" +
                            "50.4191209,30.4247277;" +
                            "50.4190505,30.4247088;" +
                            "50.4189799,30.4246898;" +
                            "50.4189092,30.4246700;" +
                            "50.4187674,30.4246298;" +
                            "50.4186957,30.4246105;" +
                            "50.4186245,30.4245901;" +
                            "50.4185531,30.4245699;" +
                            "50.4184806,30.4245494;" +
                            "50.4184074,30.4245282;" +
                            "50.4183324,30.4245071;" +
                            "50.4182557,30.4244854;" +
                            "50.4180813,30.4244371;" +
                            "50.4178792,30.4243866;" +
                            "50.4177771,30.4243588;" +
                            "50.417678,30.4243276;" +
                            "50.4175800,30.4243004;" +
                            "50.4174811,30.4242798;" +
                            "50.4173873,30.4242545;" +
                            "50.4172931,30.4242282;" +
                            "50.417197,30.4241999;" +
                            "50.4169096,30.4241141;" +
                            "50.4168155,30.4240865;" +
                            "50.4167231,30.4240598;" +
                            "50.4166317,30.4240337;" +
                            "50.4165403,30.4240084;" +
                            "50.4164485,30.4239899;" +
                            "50.4163574,30.4239802;" +
                            "50.4162726,30.4239735;" +
                            "50.4161322,30.4239386;" +
                            "50.4160708,30.4239199;" +
                            "50.416011,30.4239031;" +
                            "50.4159578,30.4238881;" +
                            "50.4159065,30.4238739;" +
                            "50.4158619,30.4238614;" +
                            "50.4158318,30.423853;" +
                            "50.4158068,30.4238461;" +
                            "50.4157607,30.4238333;" +
                            "50.4157327,30.4238254;" +
                            "50.4156995,30.423816;" +
                            "50.4156642,30.4238061;" +
                            "50.4156359,30.4237977;" +
                            "50.4156151,30.4237916;" +
                            "50.4155961,30.4237857;" +
                            "50.4155617,30.4237758;" +
                            "50.4155475,30.4237715;" +
                            "50.4155324,30.4237674;" +
                            "50.4155101,30.4237668;" +
                            "50.4154811,30.4237854;" +
                            "50.4154557,30.423828;" +
                            "50.4154387,30.4238871;" +
                            "50.4154145,30.4240073;" +
                            "50.4154017,30.4240719;" +
                            "50.4153844,30.4241387;" +
                            "50.4153627,30.4241947;" +
                            "50.41533,30.4242254;" +
                            "50.4153086,30.4242279;" +
                            "50.4152893,30.4242079;" +
                            "50.4152832,30.4241816;" +
                            "50.4152866,30.4241326;" +
                            "50.4152819,30.4241050;" +
                            "50.4152667,30.4240811;" +
                            "50.4152436,30.4240726;" +
                            "50.4152228,30.4240840;" +
                            "50.4152105,30.4241004;" +
                            "50.4152031,30.4241177;" +
                            "50.4152000,30.4241365;";
            String[] locationArray = locationsString.split(";");
            for (String aLocationArray : locationArray) {
                String[] locationSting = aLocationArray.split(",");
                Location location = new Location(LocationManager.GPS_PROVIDER);
                location.setLatitude(Double.parseDouble(locationSting[0]));
                location.setLongitude(Double.parseDouble(locationSting[1]));
                locations.add(location);
            }
        }

        private void initLocations(LatLng... locationArray) {
            List<Location> reverse = new LinkedList<>();
            for (LatLng point : locationArray) {
                Location location = new Location(LocationManager.GPS_PROVIDER);
                location.setLatitude(point.latitude);
                location.setLongitude(point.longitude);
                reverse.add(location);
            }

            for (int i = reverse.size() - 1; i > 0; i--) {
                locations.add(reverse.get(i));
            }
        }

        @Override
        protected String doInBackground(LatLng... locationArray) {
            if (locationArray.length == 0)
                initLocations();
            else
                initLocations(locationArray);

            for (Location point : locations) {
                point.setElapsedRealtimeNanos(SystemClock.elapsedRealtimeNanos());
                point.setTime(System.currentTimeMillis());
                point.setAccuracy(1);
                publishProgress(point);
                try {
                    Thread.sleep(50);
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
            }
            return null;
        }

        @Override
        protected void onProgressUpdate(Location... point) {
            listener.onLocationChanged(point[0]);
        }
    }
}
